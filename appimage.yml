version: 1

AppDir:
  path: ./AppDir

  app_info:
    id: com.siproxylin
    name: Siproxylin
    icon: com.siproxylin
    version: dev
    exec: usr/bin/python3
    exec_args: "$APPDIR/usr/share/com.siproxylin/main.py --dot-data-dir $@"

  apt:
    arch: amd64
    sources:
      - sourceline: 'deb [arch=amd64] http://deb.debian.org/debian bookworm main'
        key_url: 'https://ftp-master.debian.org/keys/archive-key-12.asc'

    include:
      - python3
      - python3-pip
      - libgstreamer1.0-0
      - libgstreamer-plugins-base1.0-0
      - gstreamer1.0-plugins-good
      - gstreamer1.0-plugins-bad
      - gstreamer1.0-pulseaudio
      - libpulse0
      - libgl1
      - libxcb-xinerama0
      - libxkbcommon-x11-0
      - libxcb-icccm4
      - libxcb-image0
      - libxcb-keysyms1
      - libxcb-randr0
      - libxcb-render-util0
      - libxcb-shape0
      - libdbus-1-3
      - libenchant-2-2
      - hunspell-en-us
      - hunspell-de-de
      - hunspell-ru
      - hunspell-lt
      - hunspell-es
      - hunspell-ro
      - hunspell-ar
      - fonts-noto-color-emoji
      - fonts-liberation
      - fontconfig

    exclude:
      - adwaita-icon-theme
      - humanity-icon-theme
      - libc6
      - libc6-dev
      - libc-bin

  files:
    include:
      - /usr/local/bin/drunk-call-service-linux
    exclude:
      - usr/share/man
      - usr/share/doc/*/README.*
      - usr/share/doc/*/changelog.*
      - usr/share/doc/*/NEWS.*
      - usr/share/doc/*/TODO.*

  runtime:
    path_mappings:
      - /usr/lib/x86_64-linux-gnu/gconv:$APPDIR/usr/lib/x86_64-linux-gnu/gconv

    env:
      APPDIR_LIBRARY_PATH: "$APPDIR/usr/lib/x86_64-linux-gnu:$APPDIR/usr/lib:$APPDIR/lib/x86_64-linux-gnu"
      PYTHONHOME: "$APPDIR/usr"
      PYTHONPATH: "$APPDIR/usr/lib/python3.11:$APPDIR/usr/lib/python3.11/site-packages"
      GST_PLUGIN_PATH: "$APPDIR/usr/lib/x86_64-linux-gnu/gstreamer-1.0"
      GST_PLUGIN_SYSTEM_PATH: "$APPDIR/usr/lib/x86_64-linux-gnu/gstreamer-1.0"
      PULSE_SYSTEM: "0"

  after_bundle:
    # Note: appimage-builder runs this BEFORE build-appimage.sh steps 7-8
    # We only ensure directory structure exists here
    # Actual file copying and pip install happen in build-appimage.sh (steps 7-8)
    - mkdir -p AppDir/usr/lib/python3.11/site-packages
    - mkdir -p AppDir/usr/share/com.siproxylin
    - mkdir -p AppDir/usr/local/bin
    - mkdir -p AppDir/usr/share/icons/hicolor/scalable/apps
    - mkdir -p AppDir/usr/share/applications

AppImage:
  arch: x86_64
  update-information: None
  sign-key: None
